---
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = F,
	message = FALSE,
	warning = FALSE
)
library(plotly)
library(tidyverse)
library(DT)
library(sparkline)
library(janitor)
```

```{r Read CSV, message=FALSE, warning=FALSE}
datatable <- read.csv("https://raw.githubusercontent.com/prayaggordy/D3-covid-map/master/data/md_counties_today_table.csv")
trendData <- read.csv("https://raw.githubusercontent.com/prayaggordy/D3-covid-map/master/data/md_counties_trend_table.csv")
```

```{r Trend lines}
trend <- select(trendData, "County", "date", "rolling_avg")
```

```{r}
line <- trend %>% 
    group_by(County) %>% 
    summarize(`14-Day Trend` = spk_chr(rolling_avg,
                           lineColor = '#456087', 
                           fillColor = FALSE,
                           lineWidth = 3,
                           chartRangeMin = 0,
                           chartRangeMax = 10,
                           width = 100,
                           height = 60,
                           highlightLineColor = '', 
                           highlightSpotColor = '',
                           spotColor = '',
                           minSpotColor = '',
                           maxSpotColor = '',
                           disableInteraction = TRUE))
```

```{r}
datatable(line, escape = F, style = 'bootstrap', class = 'table', rownames = FALSE,
            options = list(
            dom = 't',
            pageLength = 25,
            fnDrawCallback = htmlwidgets::JS('function(){
                                              HTMLWidgets.staticRender();
                                              }'))
  ) %>%
spk_add_deps()
```

```{r Setup, message=FALSE, warning=FALSE}
colnames(datatable) <- c("County", "Cases", "Deaths", "Tests", "14-Day Trend")
data <- select(datatable, "County", "Cases", "Deaths", "Tests")
```

```{r Data Table, message=FALSE, warning=FALSE}
datatable(data, style = 'bootstrap', class = 'table-hover', rownames = FALSE, options = list(
  dom = 't',
  pageLength = 25
))
```

